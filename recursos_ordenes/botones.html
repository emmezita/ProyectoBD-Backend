<style>
    #procesar:hover {
        background-color: #6e0d10 !important;
    }
    #completar:hover {
        background-color: #085523 !important;
    }
    #cancelar:hover {
        background-color: #5f450c !important;
    }
</style>

<div class="botones" style="text-align: right;">
    <button id="procesar" onclick="procesarOrden()" style="font-size: 18px; background-color:#A5141A;">Procesar</button>
    <button id="completar" onclick="completarOrden()" style="font-size: 18px; background-color: #21834A;">Completar</button>
    <button id="cancelar" onclick="cancelarOrden()" style="font-size: 18px; background-color: #D1991A;">Cancelar</button>
</div>

<script>    
    var detalleOrden = {
        idUsuario: 1, // TODO: Cambiar por el id del usuario
        presentaciones: [],
    };

    $('.body-ordenes tr').each(function(i, e) {
        var idm = $(e).find('td').eq(0).attr('idm');
        var idb = $(e).find('td').eq(0).attr('idb');
        var ido = $(e).find('td').eq(0).attr('ido');
        var cantidad = $(e).find('.cantidad').val();
        var precio = $(e).find('.precio').val();
        var datos = {
            idm: idm,
            idb: idb,
            ido: ido,
            cantidad: cantidad,
            precio: precio,
        };
        detalleOrden.presentaciones.push(datos);
    });

    var urlParams = new URLSearchParams(window.location.search);
    var idOrden = urlParams.get('id');


    function procesarOrden() {
        $.ajax({
            url: "http://localhost:5000/api/orden/compra/procesar/"+ idOrden,
            method: "PUT",
            dataType: "json",
            data: JSON.stringify(detalleOrden),
            success: function (data) {
                console.log(data);
                alert("Ã“rden procesada exitosamente");
            },
            error: function (data) {
                alert(data.responseJSON.message);
            }
        });
    }

    // function completarOrden() {
    //     $.ajax({
    //         url: "http://localhost:5000/api/orden/compra/" + idOrden + "/completar",
    //         method: "PUT",
    //         dataType: "json",
    //         success: (data) => {
    //             console.log(data)
    //             window.location.href = "http://localhost:5000/recursos_ordenes/ordenes.html";
    //         },
    //         error: (error) => {
    //             console.log(error)
    //         }
    //     });
    // }

    // function cancelarOrden() {
    //     $.ajax({
    //         url: "http://localhost:5000/api/orden/compra/" + idOrden + "/cancelar",
    //         method: "PUT",
    //         dataType: "json",
    //         success: (data) => {
    //             console.log(data)
    //             window.location.href = "http://localhost:5000/recursos_ordenes/ordenes.html";
    //         },
    //         error: (error) => {
    //             console.log(error)
    //         }
    //     });
    // }
</script>